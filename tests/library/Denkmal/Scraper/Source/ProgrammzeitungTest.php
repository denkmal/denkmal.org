<?php

class Denkmal_Scraper_Source_ProgrammzeitungTest extends CMTest_TestCase {

	public function testProcessPageDate() {
		$html = <<<'EOT'
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de" lang="de"> <head>         <title>ProgrammZeitung</title>         <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">         <META NAME="publisher" CONTENT="Stämpfli all media AG, Bern - www.allmedia.ch">         <link rel="stylesheet" href="pz_assets/styles/pz_grundstyle.css" type="text/css">         <link rel="stylesheet" href="pz_assets/styles/pz_rock.css" type="text/css">          <script type="text/javascript"> 	var intranetpath="/";  	function pop(file,windowname,features) 	{ 	helpwindow = window.open(file,windowname,features); 	helpwindow.focus(); 	return false; 	} 	 	function openSitemap(){ 		window.open('sitemap.cfm', 'frmSitemap', 'width=300,height=450,top=200,left=200,resizable=yes,scrollbars=yes'); 		}  	function openPrintDialog(uuid,show_long){ 		window.open('index.cfm?uuid=' + uuid + '&cmd=print&show_long=' + show_long, 'frmPrint', 'width=600,height=500,top=150,left=200,resizable=yes,scrollbars=yes,menubar=yes'); 		}  	function openVotingDialog(question_id, art_id){ 		window.open('index.cfm?question_id=' + question_id + '&art_id=' + art_id  + '&cmd=vote', 'frmPrint', 'width=600,height=500,top=150,left=200,resizable=yes,scrollbars=yes,menubar=yes'); 		} 	 	function onOpenHrefwh(href,trg,t,l,w,h){ 	  	var wndhr=window.open(intranetpath + 'admin/empty.html',trg,'top='+t+',left='+l+',width='+w+',height='+h+',dependent=yes,hotkeys=no,locationbar=no,menubar=no,resizable=yes,scrollbars=yes'); 		wndhr.location.href = href; 	   	if (wndhr.opener == null){ 			wndhr.opener=window; 			} 		wndhr.focus(); 		} </script>    </head>  <body id="top">          <div id="aussen">                 <div id="wrapper">                         <div id="outer">                                 <div id="inner">                                         <div id="left">                                                          <div style="padding-top:10px; padding-left:15px; padding-right:15px; height:161px;"> 				<div class="hauptnavi"><a class="hauptnavi" href="/index.cfm?1824BCBBD9D9424C432E16619483E5FF">> Home</a></div> 						<div class="hauptnavi"><a class="hauptnavi" href="index.cfm?uuid=3A18608DD9D9424C475A938A582D4155&Rubrik=11">> Agenda</a></div> 				<div class="hauptnavi"><a class="hauptnavi" href="/index.cfm?2BC7A162D9D9424C409AFFDEEEAADF15">> Abonnieren</a></div> 					<div class="hauptnavi"><a class="hauptnavi" href="/index.cfm?579692A3D9D9424C408481362E88B7EA">> Kulturszene</a></div> 					<div class="hauptnavi"><a class="hauptnavi" href="/index.cfm?2BC7F454D9D9424C454F1F1896C70EDC">> Inserieren</a></div> 					<div class="hauptnavi"><a class="hauptnavi" href="/index.cfm?2BC8563AD9D9424C4E64362B16C39E31">> Über uns</a></div> 					<div class="hauptnavi"><a class="hauptnavi" href="/index.cfm?2BC8F8E3D9D9424C42C79ADDFBBBFF6E">> Kontakt</a></div> 					<div class="hauptnavi"><a class="hauptnavi" href="/index.cfm?2BC8AF47D9D9424C4A645FA1655B96E0">> Links</a></div> 					<div class="hauptnavi"><a class="hauptnavi" href="/index.cfm?4F4B0A85D9D9424C42480A19E9FC852C">> Varia</a></div> 					 </div> 	 	<div class="subnav"><a class="subnavi" href="index.cfm?Datum_von=28.09.2013&Datum_bis=05.10.2013&uuid=2BCD9733D9D9424C4EF093B3E35CB44B&Rubrik=6"> die nächsten 7 Tage </a></div> 	<div class="subnav"><a class="subnavi" href="index.cfm?Datum_von=28.09.2013&Datum_bis=12.10.2013&uuid=2BCD9733D9D9424C4EF093B3E35CB44B&Rubrik=6"> die nächsten 14 Tage </a></div> 	<div class="subnav"><a class="subnavi" href="index.cfm?Datum_von=28.09.2013&Datum_bis=19.10.2013&uuid=2BCD9733D9D9424C4EF093B3E35CB44B&Rubrik=6"> die nächsten 21 Tage </a></div> <img src="pz_assets/images/space.gif" width="1" height="15">                                                            		 <div id="suche"> 				 AGENDA<br> 					 <form action="/index.cfm" method="get" name="editform" id="sola"> 					 <div> 					 										   				<div class="vonbis">von:</div> 									<div style="margin-bottom:2px;"> <input type="text" class="input" style="width:68px;" name="Datum_von" value="30.09.2013"> <a href="#" onClick="var e= onCalendar( 'editform', 'Datum_von', 'dd.mm.yyyy', '' );"><img src="pz_assets/images/kalender.gif" border="0" style="cursor:hand" alt="Kalender"></a></div> 						<div class="clr"></div> 									<div class="vonbis">bis:</div> 					<div> <input type="text" class="input" style="width:68px;" name="Datum_bis" value="30.09.2013"> <a href="#" onClick="var e= onCalendar( 'editform', 'Datum_bis', 'dd.mm.yyyy', '' );"><img src="pz_assets/images/kalender.gif" border="0" style="cursor:hand" alt="Kalender"></a></div> 			</div> 									<div style="margin-top:5px;margin-bottom:2px;">Suchkriterium:</div> 		<input class="input" style="width:115px;" type="text" name="suchbegriffe" value=""> 									<div style="margin-top:5px;margin-bottom:2px;">Rubriken:</div> 									<input type="hidden" name="uuid" value="2BCD9733D9D9424C4EF093B3E35CB44B"> 										  <select name="Rubrik" class="rubrik" size="1"> 											<option value="">Alle Rubriken</option> 										  	 							  	<option value="1uuid2BD3698ED9D9424C4D70C24DC2E25F4F"  											   											>Film</option> 							  	<option value="2uuid2BD4B8A3D9D9424C4FE7C7FD1EA8C245"  											   											>Theater</option> 						  	<option value="3uuid2BD506C3D9D9424C44F3C9BF75E060CB"  											   											>Tanz</option> 							  	<option value="4uuid2BD55764D9D9424C4CC6A1DE245EE2A9"  											   											>Literatur</option> 						  	<option value="5uuid2BD6913CD9D9424C47D3CC307373DA44"  											   											>Klassik, Jazz</option> 					  	<option value="6uuid2BDE975FD9D9424C4F1169C24A4933AE"  											 selected 												 						  											>Sounds & Floors</option> 					  	<option value="7uuid2BDF654ED9D9424C41ACC23DC41FB787"  											   											>Kunst</option> 						  	<option value="8uuid2BE009FAD9D9424C459658BD55570AB9"  											   											>Kinder</option> 						  	<option value="9uuid2BE0DBB2D9D9424C41C8AAACF0CB2B57"  											   											>Diverses</option> 						  	<option value="10uuid"  											  				  											>Art/Messen</option> 						  	<option value="11uuid5B4D412AD9D9424C40A309E6E3AF0974"  											  											 	 							  											>Agenda</option> 						  				</select>								 						<input type="Submit" name="Go" class="senden" style="cursor:hand" value="> Go" onclick="document.sola.submit()"><img src="pz_images/diverse/transparent.gif" alt="Hilfe Button Suche" border="0" width="8" height="1" /> 									<A onclick="return pop('help_popup.cfm?uuid=5B66540DD9D9424C4085C5399B9F63BC', 'fensterveranstaltungen', 'width=520,height=500', 'menubar=no', 'scrollbars=yes'); return false; focus()" href="help_popup.cfm?uuid=5B66540DD9D9424C4085C5399B9F63BC"><img src="pz_images/diverse/info.gif" alt="Hilfe Button Suche" border="0" width="14" height="14" /></A> 									 </form> 				 </div>                                                   <br>                                                  <br>                                         </div>                                         <div id="mitte">                                                 <div class="header" style="height:171px;">                                                         <div class="logo"> </div>                                                                 <div style="height:113px;">                                                                         <div class="abo">Abonnieren Sie jetzt:<br>                                                                                 <a class="abonavi" href="index.cfm?uuid=882B8BB8D9D9424C445FB52174D90018&abo=3">> Schnupperabo</a>, 3 Ausgaben, CHF 14.-<br />                                                                                 <a class="abonavi" href="index.cfm?uuid=882B31E0D9D9424C49C412735010CAEF&abo=4">> Jahresabo</a>, 11 Ausgaben, CHF 78.-<br />                                                                                 <a class="abonavi" href="index.cfm?uuid=882AB8B8D9D9424C42474DD8CA27F9E8">> Tagesagenda</a>, kostenlos<br />                                                                         </div>                                                                 </div>                                                                 <div class="clr"></div>                                                                 <div style="height:18px;">                                                                                                                                                 <div class="pfeilagenda1">> </div><div class="navi"><a class="navi" href="index.cfm?844B6C33D9D9424C462F379C212AB1B0">Redaktionelle Beiträge</a></div>                                                                 </div>                                                                 <div class="clr"></div>                                                                 <div style="height:18px;">                                                                                                                                                  <div class="pfeilagenda">> </div>                                                                                                                                                                                                                                   <a class="filmnavi" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&rubrik=1&menu=17">Film</a>                                                                                                                                                                  <a class="theaternavi" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&rubrik=2&menu=18">Theater</a>                                                                                                                                                                  <a class="tanznavi" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&rubrik=3&menu=19">Tanz</a>                                                                                                                                                                  <a class="literaturnavi" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&rubrik=4&menu=20">Literatur</a>                                                                                                                                                                  <a class="klassikjazznavi" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&rubrik=5&menu=21">Klassik, Jazz</a>                                                                                                                                                                  <a class="soundsfloorsnaviakt" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&rubrik=6&menu=22">Sounds & Floors</a>                                                                                                                                                                  <a class="kunstnavi" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&rubrik=7&menu=23">Kunst</a>                                                                                                                                                                  <a class="kindernavi" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&rubrik=8&menu=24">Kinder</a>                                                                                                                                                                  <a class="diversesnavi" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&rubrik=9&menu=25">Diverses</a>                                                                                                                                                                  <a class="tagesagendanavi" href="index.cfm?uuid=2BCD9733D9D9424C4EF093B3E35CB44B&menu=2">Tagesagenda 28.09.2013</a>                                                                                                                                                                                                                           </div>                                                                 <div class="clr"></div>                                                 </div>                                                 <div id="content"><br><h1>Sounds & Floors</h1>                                                             		 <script language="JavaScript" src="js/admin.js"></script>  			 	 	 	 	 	 	 	 	 <br> 					<div class="contenttitel"> 						<div class="titeltag">Montag | 30.09.2013</div> 						<div class="titelort">Ort [Veranstalter]</div> 						<div class="titelzeit"> </div> 					</div> 				 				 			       	    	     			 				 					 					<div class="contentrahmen"> 						<div class="veranstaltung"><b>Milonga@LesGarecons</b> Tango tanzen, sehen oder zuhören </div> 						<div class="ort"><a href="http://www.lesgarecons.ch" target="_blank">Rest. Les Gareçons, Bad. Bhf</a>, Schwarzwaldallee 200</div> 						<div class="zeit">19.30 – 23.30</div> 			</div> 					<div class="clr"></div> 				 				 			       		 			 			       	    	     			 				 		<div class="contentrahmen"> 						<div class="veranstaltung"><b>Tango</b> Übungsabend mit Schnupperstunde </div> 						<div class="ort"><a href="http://www.tangobasel.ch" target="_blank">Tango Schule Basel</a>, Clarahofweg 23</div> 						<div class="zeit">20.00 – 22.30</div> 					</div> 			<div class="clr"></div> 				 			 			       			   	 		   	                                                    </div>                                         </div>                                         <div id="right">                                                  <div class="banner"><!-- Banner (19A63B29D9D9424C402EED37A8A99BC7) begin<a href="http://www.programmzeitung.ch/bannerclick.cfm?uuid=19A63B29D9D9424C402EED37A8A99BC7&id=8" style="cursor:hand" target="ExiRacerWnd"><img b<a href="http://www.programmzeitung.ch/bannerclick.cfm?uuid=66EF42DAEF54E2DB1D9A244042A10CC7&id=1" style="cursor:hand" target="ExiRacerWnd"><img b<a href="http://www.programmzeitung.ch/bannerclick.cfm?uuid=10BE24C3AD8B42372480F4BDDFFBA2E6&id=5" style="cursor:hand" target="ExiRacerWnd"><img b</div>                                                 <div class="banner"></div>                                                 <div class="bann<a href="http://www.programmzeitung.ch/bannerclick.cfm?uuid=3A708D5FD9D9424C4C2AB6AC49C76A16&id=7" style="cursor:hand" target="ExiRacerWnd"><img b<a href="http://www.programmzeitung.ch/bannerclick.cfm?uuid=19B0EBB8D9D9424C44B0065F7ECAE926&id=9" style="cursor:hand" target="ExiRacerWnd"><img b</div>                                         </div>                                 </div>                         </div>                         <div id="footer">                                 <div class="trennquer"></div>                                         <div style="padding-left:175px; float:left;">                                                 <a href="#top">> nach oben</a>    <a href="pz_print_rubrik.cfm?&Datum_von=30.09.2013&Datum_bis=30.09.2013&uuid=18276F29D9D9424C4EF563A6AD4AB598&ShowFullText=1&Rubrik=6" target="_blank">> Artikel drucken</a>                                         </div>                                         <div style="padding-right:160px; float:right; white-space:nowrap;">                                                 © 2006 ProgrammZeitung Verlags AG  <a href="index.cfm?6F7AE2DAD9D9424C4DB42A8F6711ED02">> Impressum</a>  <a href="index.cfm?6F7BA966D9D9424C4F4C1A4F53B07468">> rechtliche Hinweise</a>                                         </div>                         </div>                 </div>         </div>          	 	<!-- etracker TARGET PARAMETER 2.0.1 --> 	<script type="text/javascript"> 	var et_target = ""; 	var et_tval = ""; 	var et_tsale = 0; 	var et_tonr = ""; 	</script> 	<!-- etracker TARGET PARAMETER END --> 	 	<!-- etracker CAMPAIGN PARAMETER 2.0.2 --> 	<script type="text/javascript"> 	var et_lpage = ""; 	var et_trig = ""; 	</script> 	<!-- etracker CAMPAIGN PARAMETER END --> 	 <!-- etracker PARAMETER 2.0.1 --> <script type="text/javascript"> var et_easy = 0; var et_ssl = 0; var et_pagename = "%20%2FHome%2FRubriken"; var et_areas = ""; var et_ilevel = 1; </script> <!-- etracker PARAMETER END -->  <!-- etracker TARGET PARAMETER 2.1.0 --> <script type="text/javascript"> var et_basket = ""; <!--- var et_basket = ""; ---> </script> <!-- etracker TARGET PARAMETER END -->  <!-- etracker CODE 2.1.0 --> <script type="text/javascript"> var et_server="http://www.etracker.de"; var et_sslserver="https://www.etracker.de"; var et_referer=et_server+"/soverview.php?c=1&et="; var et_sw,et_sc="na";var tmp,cex='';if(typeof(et_pl)=="undefined"){if( navigator.appName=='Netscape'||navigator.appName=='Opera'){for(i=0;i<navigator. plugins.length;++i)et_pl+=navigator.plugins[i].name+';';}else et_pl=''} function et_pQ(param){var ll,fl;var qS,pV,rS;qS=document.location.search;pV=""; if(qS.length>1){qS=qS.substr(1);fl=qS.indexOf(param);if(fl!=-1){fl+=param.length+1; ll=qS.indexOf('&',fl);if(ll==-1) ll=qS.length;pV=qS.substring(fl,ll);rS=new RegExp (" ","g");pV=pV.replace(rS,"+");f1=pV.indexOf('=',0);pV=pV.substring(f1+1);}} return pV;} function et_eC(param){var et_a='',et_t='',et_p='',et_b='';var et_ref= escape(document.referrer);if(typeof(top.document)=="object")et_ref=escape(top.document. referrer);if(et_ref!="")et_ref="&ref="+et_ref;et_sw="&swidth="+et_sw; et_sc="&scolor="+et_sc;if(et_easy)et_easy="&et_easy=1";else et_easy=""; if(et_pl!="")et_pl="&p="+escape(et_pl);if(et_areas!="")et_a="&et_areas="+ escape(et_areas);if(typeof(et_target)=="undefined"||typeof(et_target)== "unknown"){et_target="";et_tval="0";et_tonr="0";et_tsale=0;}if(typeof( et_lpage)=="undefined"||typeof(et_lpage)=="unknown")et_lpage="";else et_lpage="&et_lpage="+et_lpage;if(typeof(et_trig)=="undefined"||typeof( et_trig)=="unknown")et_trig="";if(et_trig!="")cex="&et_trig="+ et_trig;if((tc=et_pQ("et_cid"))&&(tl=et_pQ("et_lid")))cex=cex+"&et_cid="+ tc+"&et_lid="+tl;if(tmp=et_pQ("et_target")||et_target!=""){tv=et_pQ ("et_tval");to=et_pQ("et_tonr");ts=et_pQ("et_tsale");et_t="&et_target="+ escape(tmp.length?tmp:et_target)+","+(tv?tv:et_tval)+","+(to?to:et_tonr)+ ","+(ts?ts:et_tsale)+","+(typeof(et_cust)=="number"?et_cust:0);}if( et_pagename!="")et_p="&et_pagename="+escape(et_pagename);if(typeof( et_basket)=="string")et_b="&et_basket="+escape(et_basket);tc= new Date();document.write("<a target='_blank' href='"+et_referer+param+"'>"+ "<img border='0' alt='' src='"+(et_ssl==1?et_sslserver:et_server)+"/cnt.php?"+ "java=y&et_se=89&tc="+tc.getTime()+"&et="+param+"&et_ilevel="+ et_ilevel+et_easy+et_p+et_a+cex+et_t+et_lpage+et_b+et_sw+et_sc+et_ref+et_pl+ "'/><\/a>");}</script><script type="text/javascript1.2">et_sw=screen.width;et_sc= navigator.appName!='Netscape'?screen.colorDepth:screen.pixelDepth;</script> <script type="text/javascript">et_eC('7PK6P3');</script>  <!-- etracker CODE NOSCRIPT --> <noscript> <a target="_blank" href="http://preview.etracker.de/soverview.php?c=1&et=7PK6P3"> <img border="0" alt="" src="http://preview.etracker.de/cnt.php?et=7PK6P3&java=n& et_easy=0&et_pagename=&et_areas=&et_ilevel=0&et_basket=& et_target=,0,0,&et_lpage=0&et_trig=0,0"/></a> </noscript> <!-- etracker CODE END -->    </body> </html>
EOT;

		$scraper = $this->getMockBuilder('Denkmal_Scraper_Source_Programmzeitung')->setMethods(array('_addEventAndVenue'))->getMock();
		$scraper->expects($this->at(0))->method('_addEventAndVenue')->with(
			'Rest. Les Gareçons',
			new Denkmal_Scraper_Description('Milonga@LesGarecons: Tango tanzen, sehen oder zuhören '),
			new DateTime('2013-03-13 19:30:00'),
			new DateTime('2013-03-13 23:30:00')
		);
		$scraper->expects($this->at(1))->method('_addEventAndVenue')->with(
			'Tango Schule Basel',
			new Denkmal_Scraper_Description('Tango: Übungsabend mit Schnupperstunde '),
			new DateTime('2013-03-13 20:00:00'),
			new DateTime('2013-03-13 22:30:00')
		);
		/** @var Denkmal_Scraper_Source_Programmzeitung $scraper */

		$scraper->processPageDate(new Denkmal_Scraper_String($html), new DateTime('2013-03-13'));
	}
}
